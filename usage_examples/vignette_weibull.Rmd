---
title: "Weibull Frailty Workflow"
output: html_document
---

```{r setup}
source("../scripts/R/legacy/analysis/baseline_weibull.R")
source("../scripts/R/legacy/analysis/simulate_frailty.R")
source("../scripts/R/legacy/analysis/estimate_frailty_mle.R")
source("../scripts/R/legacy/analysis/coverage_study.R")
source("../scripts/R/legacy/analysis/funnel_plot.R")
source("../scripts/R/legacy/analysis/wrapper_pipeline.R")
```

## Simulating data

```{r simulation}
set.seed(123)
sim <- simulate_frailty(n = 100, shape = 1.2, scale = 1, theta = 0.5)
head(sim)
```

## Estimating parameters

```{r estimation}
fit <- estimate_frailty_mle(sim)
fit
```

## Coverage study

```{r coverage}
cover <- coverage_study_multi(sample_sizes = c(50, 100, 200),
                              shape = 1.2, scale = 1, theta = 0.5,
                              nsim = 50)
cover
```

## Funnel plot

```{r funnel, fig.height=4, fig.width=6}
plot <- funnel_plot(cover)
plot
```

## Wrapper pipeline

```{r pipeline}
pipeline <- frailty_simulation_pipeline_weibull(shape = 1.2, scale = 1,
                                                theta = 0.5, nsim = 50,
                                                sample_sizes = c(100, 200, 400))
str(pipeline, max.level = 1)
```
